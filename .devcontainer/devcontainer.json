{
  "name": "Go Distributed Cache",
  // Use Microsoft's official Go dev container image (latest Go 1.x)
  "build": {
    "dockerfile": "Dockerfile"
  },
  // Features to add to the container
  "features": {
    "ghcr.io/devcontainers/features/docker-in-docker:2": {},
    "ghcr.io/devcontainers/features/kubectl-helm-minikube:1": {}
  },
  // VS Code customizations
  "customizations": {
    "vscode": {
      "settings": {
        // Disable AI completions
        "github.copilot.enable": {
          "*": false
        },
        "editor.inlineSuggest.enabled": false,
        // Keep IntelliSense
        "editor.quickSuggestions": {
          "other": true,
          "comments": false,
          "strings": false
        },
        "editor.suggestOnTriggerCharacters": true,
        "editor.acceptSuggestionOnEnter": "on",
        // Go-specific settings
        "go.useLanguageServer": true,
        "go.lintOnSave": "workspace",
        "go.vetOnSave": "workspace",
        "go.formatTool": "goimports",
        "go.lintTool": "golangci-lint",
        "go.lintFlags": [
          "--fast"
        ],
        // Format on save
        "[go]": {
          "editor.formatOnSave": true,
          "editor.codeActionsOnSave": {
            "source.organizeImports": "explicit"
          }
        },
        // Editor
        "editor.rulers": [
          80,
          120
        ],
        "editor.tabSize": 2,
        "editor.insertSpaces": false,
        "files.trimTrailingWhitespace": true,
        "files.insertFinalNewline": true
      },
      // Extensions installed in container (Go-specific only)
      // Your global "infra" extensions stay on host
      "extensions": [
        // Go language
        "golang.go",
        // Markdown (project docs)
        "yzhang.markdown-all-in-one"
      ]
    }
  },
  // Port forwarding for your cache server
  "forwardPorts": [
    42069,
    8080
  ],
  "portsAttributes": {
    "42069": {
      "label": "Cache Server"
    },
    "8080": {
      "label": "P2P Node"
    }
  },
  // Mount your .gitconfig and ssh keys
  "mounts": [
    "source=${localEnv:HOME}/.gitconfig,target=/home/vscode/.gitconfig,type=bind,consistency=cached",
    "source=${localEnv:HOME}/.ssh/id_ed25519_github,target=/home/vscode/.ssh/id_ed25519_github,type=bind",
    "source=${localEnv:HOME}/.ssh/id_ed25519_github.pub,target=/home/vscode/.ssh/id_ed25519_github.pub,type=bind",
    "source=${localEnv:HOME}/.ssh/known_hosts,target=/home/vscode/.ssh/known_hosts,type=bind"
  ],
  // Run commands after container is created
  "postCreateCommand": "chmod 600 ~/.ssh/id_ed25519_github && make install"
}
